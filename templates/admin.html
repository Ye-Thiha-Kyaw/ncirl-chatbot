<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Knowledge Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <div class="container">
        <div class="admin-panel">
            <div class="admin-header">
                <a href="/" class="back-link">‚Üê Back to Chat</a>
                <h1>üìö Knowledge Management Panel</h1>
                <!-- NEW: Logout Button -->
                <a href="/admin/logout" class="logout-link">üö™ Logout</a>
            </div>
            <div class="admin-content">
                <div class="stats" id="stats">
                    <div class="stat-card">
                        <h3 id="totalKnowledge">0</h3>
                        <p>Total Knowledge Entries</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCategories">0</h3>
                        <p>Categories</p>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchTab('add')">‚ûï Add Knowledge</button>
                    <button class="tab" onclick="switchTab('upload')">üì§ Bulk Upload CSV</button>
                    <button class="tab" onclick="switchTab('view')">üìã View All</button>
                </div>

                <div id="addTab" class="tab-content active">
                    <div id="successMsg" class="success-message"></div>
                    <div id="errorMsg" class="error-message"></div>
                    
                    <form id="knowledgeForm">
                        <div class="form-group">
                            <label>Category *</label>
                            <select id="category" required>
                                <option value="">Select a category</option>
                                <option value="admissions">Admissions</option>
                                <option value="library">Library</option>
                                <option value="support">Support</option>
                                <option value="facilities">Facilities</option>
                                <option value="courses">Courses</option>
                                <option value="fees">Fees & Payments</option>
                                <option value="accommodation">Accommodation</option>
                                <option value="events">Events</option>
                                <option value="sports">Sports & Clubs</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Question *</label>
                            <input type="text" id="question" placeholder="e.g., What are the exam dates?" required />
                        </div>
                        <div class="form-group">
                            <label>Answer *</label>
                            <textarea id="answer" placeholder="Provide a detailed and helpful answer..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Source</label>
                            <input type="text" id="source" placeholder="e.g., NCIRL Website, Student Handbook" value="Admin Input" />
                        </div>
                        <button type="submit" class="btn-submit">‚úì Add to Knowledge Base</button>
                    </form>
                </div>

                <div id="uploadTab" class="tab-content">
                    <div id="uploadSuccessMsg" class="success-message"></div>
                    <div id="uploadErrorMsg" class="error-message"></div>
                    
                    <div class="csv-upload-section">
                        <h3>üì§ Bulk Upload Knowledge Base</h3>
                        
                        <div class="upload-area">
                            <div class="file-input-wrapper">
                                <label for="csvFile" class="file-input-label">
                                    üìÅ Choose CSV File
                                </label>
                                <input type="file" id="csvFile" accept=".csv" />
                            </div>
                            <span class="file-name" id="fileName">No file selected</span>
                            <button id="uploadBtn" class="btn-upload" disabled>Upload & Import</button>
                        </div>
                        
                        <div class="upload-instructions">
                            <strong>üìã CSV Format Required:</strong><br>
                            Your CSV file must have these columns (in this exact order):<br>
                            <code>category, question, answer, source</code>
                            <br><br>
                            <strong>Supported Categories:</strong> admissions, library, support, facilities, courses, fees, accommodation, events, sports, other
                            <br><br>
                            <a href="/download_sample_csv" class="btn-download-template" download>
                                ‚¨áÔ∏è Download Sample Template
                            </a>
                        </div>
                        
                        <div class="progress-info" id="progressInfo">
                            Uploading... Please wait.
                        </div>
                    </div>
                </div>

                <div id="viewTab" class="tab-content">
                    <div id="knowledgeList" class="knowledge-list">
                        <div class="loading-spinner">Loading knowledge base...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Knowledge Entry</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>Category *</label>
                    <select id="editCategory" required>
                        <option value="admissions">Admissions</option>
                        <option value="library">Library</option>
                        <option value="support">Support</option>
                        <option value="facilities">Facilities</option>
                        <option value="courses">Courses</option>
                        <option value="fees">Fees & Payments</option>
                        <option value="accommodation">Accommodation</option>
                        <option value="events">Events</option>
                        <option value="sports">Sports & Clubs</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Question *</label>
                    <input type="text" id="editQuestion" required />
                </div>
                <div class="form-group">
                    <label>Answer *</label>
                    <textarea id="editAnswer" required></textarea>
                </div>
                <div class="form-group">
                    <label>Source</label>
                    <input type="text" id="editSource" />
                </div>
                <div class="modal-buttons">
                    <button type="button" class="modal-btn modal-btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üóëÔ∏è Delete Knowledge Entry</h2>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>
            <p style="margin-bottom: 20px; color: #666;">Are you sure you want to delete this knowledge entry? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" style="background: #dc3545;" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>